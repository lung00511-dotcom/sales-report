<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éŠ·å”®å ±æ•¸å¹³å°</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; background: #f3f4f6; color: #1f2937; }
        
        .navbar { background: linear-gradient(135deg, #3b82f6 0%, #1e40af 100%); padding: 1.2rem 2rem; display: flex; justify-content: space-between; align-items: center; color: white; }
        .navbar h1 { font-size: 1.4rem; font-weight: bold; }
        .navbar-actions { display: flex; gap: 1rem; align-items: center; }
        .navbar-user { color: white; font-size: 0.95rem; }
        .logout-btn { background: rgba(255,255,255,0.25); color: white; padding: 0.6rem 1.2rem; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; }
        
        .container { max-width: 1200px; margin: 0 auto; padding: 2rem 1.5rem; }
        
        /* LOGIN SCREEN */
        #login-screen { display: flex; align-items: center; justify-content: center; min-height: 100vh; background: linear-gradient(135deg, #3b82f6 0%, #1e40af 100%); padding: 1rem; }
        .login-box { background: white; padding: 3rem; border-radius: 12px; width: 100%; max-width: 420px; text-align: center; box-shadow: 0 20px 60px rgba(0,0,0,0.2); }
        .login-box h2 { font-size: 2.2rem; color: #3b82f4; margin-bottom: 1rem; }
        .login-box p { color: #6b7280; margin-bottom: 2rem; }
        .login-input { width: 100%; padding: 0.95rem; margin-bottom: 1rem; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 0.95rem; }
        .login-btn { width: 100%; padding: 1rem; background: linear-gradient(135deg, #3b82f4 0%, #1e40af 100%); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 1rem; }
        .login-hints { margin-top: 2rem; padding-top: 2rem; border-top: 2px solid #e5e7eb; font-size: 0.85rem; color: #6b7280; text-align: left; }
        
        #staff-screen, #admin-screen { display: none; }
        
        .form-card { background: white; padding: 2.5rem; border-radius: 12px; margin-bottom: 2rem; box-shadow: 0 2px 8px rgba(0,0,0,0.06); }
        .form-card h2 { font-size: 1.3rem; color: #3b82f4; margin-bottom: 1.5rem; }
        .form-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 1.5rem; margin-bottom: 1.5rem; }
        .form-group { display: flex; flex-direction: column; }
        .form-group label { font-weight: bold; margin-bottom: 0.5rem; font-size: 0.9rem; }
        .form-group input, .form-group textarea, .form-group select { padding: 0.8rem; border: 1px solid #d1d5db; border-radius: 6px; font-size: 0.95rem; }
        
        .gadgets-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1.2rem; margin-bottom: 1.5rem; }
        .gadget-card { padding: 1rem; background: white; border: 2px solid #e5e7eb; border-radius: 8px; cursor: pointer; text-align: center; font-weight: bold; transition: all 0.3s; display: flex; flex-direction: column; align-items: center; gap: 0.6rem; box-shadow: 0 1px 3px rgba(0,0,0,0.05); }
        .gadget-card:hover { border-color: #3b82f4; background: #eff6ff; }
        .gadget-card.active { background: #3b82f4; color: white; border-color: #1e40af; }
        .gadget-img { width: 100%; height: 80px; display: flex; align-items: center; justify-content: center; background: #f3f4f6; border-radius: 6px; font-size: 2rem; }
        .gadget-label { font-size: 0.8rem; line-height: 1.3; }
        
        .gadget-detail { display: none; background: linear-gradient(135deg, #eff6ff 0%, #e0f2fe 100%); padding: 2rem; border-radius: 8px; border-left: 4px solid #3b82f4; margin-bottom: 1.5rem; }
        .gadget-detail.active { display: block; }
        .detail-header { display: flex; gap: 2rem; }
        .detail-image { min-width: 100px; }
        .detail-image-box { width: 100px; height: 100px; display: flex; align-items: center; justify-content: center; background: white; border-radius: 8px; font-size: 2.5rem; }
        .detail-content h3 { color: #3b82f4; font-size: 1.2rem; margin-bottom: 0.5rem; font-weight: bold; }
        .brand-section { background: white; padding: 1rem; border-radius: 6px; margin-bottom: 1rem; border-left: 3px solid #ef4444; }
        .brand-name { color: #ef4444; font-weight: bold; }
        .brand-desc { font-size: 0.9rem; color: #374151; }
        .detail-content p { font-size: 0.95rem; color: #374151; margin-bottom: 0.8rem; }
        .pain-points li { margin-left: 1.2rem; margin-bottom: 0.5rem; font-size: 0.95rem; color: #374151; }
        
        .qty-input { display: none; margin-bottom: 1.5rem; }
        .submit-btn { width: 100%; padding: 1.1rem; background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 1rem; }
        .success-alert { display: none; padding: 1rem; background: #d1fae5; color: #065f46; border-radius: 8px; margin-top: 1rem; text-align: center; font-weight: bold; }
        .success-alert.show { display: block; }
        
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 1.5rem; margin-bottom: 2rem; }
        .stat-box { background: white; padding: 1.5rem; border-radius: 8px; border-top: 4px solid #3b82f4; text-align: center; }
        .stat-label { font-size: 0.8rem; color: #6b7280; font-weight: bold; margin-bottom: 0.8rem; }
        .stat-value { font-size: 2.4rem; font-weight: bold; color: #3b82f4; }
        
        .table-card { background: white; border-radius: 8px; overflow: hidden; }
        .table-header { background: #f3f4f6; padding: 1rem 1.5rem; display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #e5e7eb; }
        .export-btn { padding: 0.8rem 1.5rem; background: #3b82f4; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; }
        
        table { width: 100%; border-collapse: collapse; }
        table th { background: #f9fafb; padding: 1rem 1.5rem; text-align: left; font-weight: bold; border-bottom: 2px solid #e5e7eb; font-size: 0.9rem; }
        table td { padding: 0.9rem 1.5rem; border-bottom: 1px solid #e5e7eb; font-size: 0.9rem; }
        .no-data { text-align: center; padding: 3rem; color: #9ca3af; }
        
        .emoji-icon { font-size: 1.5rem; }
    </style>
</head>
<body>

<!-- LOGIN SCREEN -->
<div id="login-screen">
    <div class="login-box">
        <h2>ğŸ“Š éŠ·å”®å ±æ•¸å¹³å°</h2>
        <p>Gadget Installment Offer</p>
        <input type="text" id="user-name" class="login-input" placeholder="è¼¸å…¥åå­—" />
        <select id="user-role" class="login-input">
            <option value="">é¸æ“‡èº«ä»½</option>
            <option value="staff">åŒäº‹ (å ±æ•¸)</option>
            <option value="admin">ç®¡ç†å“¡ (æŸ¥çœ‹çµ±è¨ˆ)</option>
        </select>
        <div id="admin-pass-section" style="display: none;">
            <input type="password" id="admin-pass" class="login-input" placeholder="è¼¸å…¥å¯†ç¢¼" />
        </div>
        <button class="login-btn" onclick="handleLogin()">ğŸ”“ ç™»å…¥</button>
        <div class="login-hints">
            <p><strong>ğŸ‘¥ åŒäº‹ç™»å…¥</strong></p>
            <p>ä¾‹å¦‚: Sarah / Becky / Tom</p>
        </div>
    </div>
</div>

<!-- STAFF SCREEN -->
<div id="staff-screen">
    <div class="navbar">
        <h1>ğŸ“‹ åŒäº‹å ±æ•¸è¡¨å–®</h1>
        <div class="navbar-actions">
            <div class="navbar-user">
                <span id="staff-name">åŒäº‹: -</span> | 
                <span id="staff-date">æ—¥æœŸ: -</span>
            </div>
            <button class="logout-btn" onclick="logout()">ğŸšª ç™»å‡º</button>
        </div>
    </div>
    <div class="container">
        <div class="form-card">
            <h2>ğŸ“ å¡«å¯«ä»Šæ—¥éŠ·å”®æ•¸æ“š</h2>
            <form onsubmit="submitStaffReport(event)">
                <h3 style="margin-bottom: 1rem; color: #3b82f4;">ğŸ ç¦®å“éŠ·å”® (é»æ“Šé¸æ“‡)</h3>
                <div class="gadgets-grid" id="gadgets-grid"></div>
                
                <div id="gadget-detail" class="gadget-detail">
                    <div class="detail-header">
                        <div class="detail-image">
                            <div class="detail-image-box" id="detail-emoji">ğŸ“¦</div>
                        </div>
                        <div class="detail-content" style="flex: 1;">
                            <h3 id="detail-name"></h3>
                            <div class="brand-section">
                                <div class="brand-name" id="detail-brand"></div>
                                <div class="brand-desc" id="detail-brand-desc"></div>
                            </div>
                            <p><strong>å‹è™Ÿ:</strong> <span id="detail-model"></span></p>
                            <p><strong>ğŸ’° SRP åŸåƒ¹:</strong> <span id="detail-srp" style="color: #ef4444; font-size: 1.1rem;"></span></p>
                        </div>
                    </div>
                    <div style="margin-top: 1.5rem; padding-top: 1.5rem; border-top: 1px solid rgba(59, 130, 246, 0.2);">
                        <p style="margin-bottom: 1rem;"><strong style="color: #1e40af;">ğŸ’¡ ç”¢å“äº®é» & å¯¦éš›ç”¨é€”ï¼š</strong></p>
                        <ul class="pain-points" id="detail-pain"></ul>
                    </div>
                </div>
                
                <div class="qty-input">
                    <div class="form-group">
                        <label id="qty-label">æ•¸é‡</label>
                        <input type="number" id="gadget-qty" min="0" value="0" />
                    </div>
                </div>
                
                <h3 style="margin-top: 2rem; margin-bottom: 1rem; color: #3b82f4;">ğŸ“Š éŠ·å”®æ•¸æ“š</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label>ğŸ“± CIS è¨‚å–®æ•¸</label>
                        <input type="number" id="cis" min="0" value="0" />
                    </div>
                    <div class="form-group">
                        <label>â• VAS å¢å€¼æœå‹™</label>
                        <input type="number" id="vas" min="0" value="0" />
                    </div>
                </div>
                
                <h3 style="margin-bottom: 1rem; color: #3b82f4;">ğŸ‘” åœ˜éšŠè³‡è¨Š</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label>Leader</label>
                        <select id="leader" required>
                            <option value="">é¸æ“‡ Leader</option>
                            <option value="Nelson Wong">Nelson Wong</option>
                            <option value="Billy Lam">Billy Lam</option>
                            <option value="Timothy Chan">Timothy Chan</option>
                        </select>
                    </div>
                </div>
                
                <h3 style="margin-bottom: 1rem; color: #3b82f4;">ğŸ“± Ad-Hoc VAS</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label>2500M</label>
                        <input type="number" id="adhoc1" min="0" value="0" />
                    </div>
                    <div class="form-group">
                        <label>Router</label>
                        <input type="number" id="adhoc2" min="0" value="0" />
                    </div>
                    <div class="form-group">
                        <label>PCD NEW</label>
                        <input type="number" id="adhoc3" min="0" value="0" />
                    </div>
                </div>
                
                <div class="form-group">
                    <label>ğŸ“Œ å‚™è¨» (é¸å¡«)</label>
                    <textarea id="notes" style="min-height: 100px;"></textarea>
                </div>
                
                <button type="submit" class="submit-btn" style="margin-top: 1.5rem;">âœ… æäº¤å ±æ•¸</button>
            </form>
            <div id="success-msg" class="success-alert">âœ… å ±æ•¸å·²æˆåŠŸä¿å­˜ï¼</div>
        </div>
    </div>
</div>

<!-- ADMIN SCREEN -->
<div id="admin-screen">
    <div class="navbar">
        <h1>ğŸ“Š ç®¡ç†å“¡å„€è¡¨æ¿</h1>
        <button class="logout-btn" onclick="logout()">ğŸšª ç™»å‡º</button>
    </div>
    <div class="container">
        <div class="stats-grid" id="stats-grid"></div>
        
        <div class="table-card">
            <div class="table-header">
                <h3>ğŸ“ˆ å³æ™‚éŠ·å”®çµ±è¨ˆè¡¨</h3>
                <button class="export-btn" onclick="exportToSharePoint()">ğŸ“¤ ä¸Šå‚³åˆ° SharePoint</button>
            </div>
            <div style="overflow-x: auto;">
                <table id="report-table">
                    <thead>
                        <tr>
                            <th>æ—¥æœŸ</th><th>åŒäº‹åç¨±</th><th>Leader</th><th>CIS</th><th>VAS</th><th>2500M</th><th>Router</th><th>PCD NEW</th><th>ç¦®å“éŠ·å”®</th><th>å‚™è¨»</th>
                        </tr>
                    </thead>
                    <tbody id="table-body"></tbody>
                </table>
            </div>
            <div id="no-data-msg" class="no-data">æš«ç„¡å ±æ•¸æ•¸æ“š</div>
        </div>
    </div>
</div>

<script>
const ADMIN_PASSWORD = "admin2024";

const GADGETS = [
    { id: 0, name: "æ›ç‡™é‡‘çƒé›»å£“æ‰‹æŒæ›ç‡™æ©Ÿ", brand: "inno3C", brandDesc: "inno3C - å‰µæ–°3Cç§‘æŠ€å“ç‰Œï¼Œå°ˆæ³¨æ–¼æ™ºèƒ½ç”Ÿæ´»é›»å™¨", model: "i-GS1", emoji: "ğŸ”¥", pain: ["âœ“ ç„¡æŠ˜ç–Šå¹³æ¿è¨­è¨ˆ - æ¯”å‚³çµ±æ›ç‡™æ©Ÿç´°å•²ï¼Œå””æœƒå’é˜»ä½","âœ“ å°ˆæ¥­æ›ç‡™åŠ›åº¦ - å³ä½¿ä¿‚åšæ–™è¡£æœéƒ½èƒ½ä¸€æ¬¡éå¹³å¥½","âœ“ æ™ºèƒ½æº«æ§ - å””æœƒéç†±å‚·è¡£æ–™","âœ“ å¿«é€Ÿé”æº« - åªéœ€30ç§’é ç†±"], srp: "$598" },
    { id: 1, name: "æ‘ºç–Šè² é›¢å­é«˜é€Ÿé¢¨ç­’", brand: "inno3C", brandDesc: "inno3C - å‰µæ–°3Cç§‘æŠ€å“ç‰Œï¼Œå°ˆæ³¨æ–¼æ™ºèƒ½ç”Ÿæ´»é›»å™¨", model: "i-FD8", emoji: "ğŸ’¨", pain: ["âœ“ æ‘ºç–Šè¨­è¨ˆ - æ”¶ç´å¾Œæ¥µå…¶è¼•è–„","âœ“ ä¸æ˜“éç†± - æ¡ç”¨é™¶ç“·åŠ ç†±æŠ€è¡“","âœ“ é›¢å­è­·é«® - è² é›¢å­è’¸æ°£å¿«é€Ÿé–æ°´","âœ“ é¢¨åŠ›å¼·å‹ - æ…³æ™‚é–“è¶³è¶³15åˆ†é˜"], srp: "$698" },
    { id: 2, name: "æ™ºèƒ½ç„¡ç·šHEPAæ—‹é¢¨å¸å¡µæ©Ÿ", brand: "Smartech", brandDesc: "Smartech - é¦™æ¸¯æœ¬åœ°æ™ºèƒ½å®¶é›»å“ç‰Œ", model: "SV-8178", emoji: "ğŸ ", pain: ["âœ“ ç„¡ç·šè¨­è¨ˆ - å””æ´—ç‰½å°¾ï¼Œè¡Œå‹•è‡ªå¦‚","âœ“ å¼·å‹å¸åŠ› - ä¸€å¸å³æ·¨","âœ“ HEPAæ¿¾ç¶² - éæ¿¾99.99%å¡µåŸƒ","âœ“ è¼•å·§ä¾¿æ”œ - é‡é‡åªå¾—å‚³çµ±å¸å¡µæ©Ÿä¸€åŠ"], srp: "$1,498" },
    { id: 3, name: "å³ç†±UV-Cè¶…æ¿¾é£²æ°´æ©Ÿ", brand: "inno3C", brandDesc: "inno3C - å‰µæ–°3Cç§‘æŠ€å“ç‰Œï¼Œå°ˆæ³¨æ–¼æ™ºèƒ½ç”Ÿæ´»é›»å™¨", model: "i-WD25", emoji: "ğŸ’§", pain: ["âœ“ 5ç§’å³ç†± - æ¯”å‚³çµ±ç‡’æ°´å£ºå¿«10å€","âœ“ UV-Cæ®ºèŒ - æ·±å±¤æ®ºèŒ99.9%","âœ“ äº”å±¤è¶…æ¿¾ - å»é™¤é‡é‡‘å±¬ã€æ°¯æ°£","âœ“ ç¯€èƒ½ç’°ä¿ - å…¨å¹´æ…³è¿”æˆåƒå…ƒé›»è²»"], srp: "$2,998" },
    { id: 4, name: "å³ç†±é£²æ°´æ©Ÿ + è¶…æ¿¾æ¿¾èŠ¯å¥—è£", brand: "inno3C", brandDesc: "inno3C - å‰µæ–°3Cç§‘æŠ€å“ç‰Œï¼Œå°ˆæ³¨æ–¼æ™ºèƒ½ç”Ÿæ´»é›»å™¨", model: "i-WD25 Bundle", emoji: "â­", pain: ["âœ“ å®Œæ•´å¥—è£ - æ©Ÿå™¨ + 2å¹´ä»½æ¿¾èŠ¯","âœ“ è¶…å€¼çµ„åˆ - æ…³è¿”æˆç™¾å…ƒ","âœ“ é•·æœŸå®‰å¿ƒ - 24å€‹æœˆæ¿¾èŠ¯ä¾›æ‡‰","âœ“ å®Œç¾å…¥å±‹ç¦® - è§£æ±ºæ•´å¹´é£²æ°´éœ€æ±‚"], srp: "$3,596" },
    { id: 5, name: "Jelly Fish è—ç‰™å–‡å­", brand: "Jelly Fish", brandDesc: "Jelly Fish - æ–°èˆˆéŸ³æ¨‚ç§‘æŠ€å“ç‰Œ", model: "Bluetooth Speaker", emoji: "ğŸ”Š", pain: ["âœ“ æ¥µè¼•ä¾¿æ”œ - æ”¾èƒŒåŒ…æ¯«ç„¡è² æ“”","âœ“ é˜²æ°´é˜²å¡µ - IPX7é˜²æ°´ç­‰ç´š","âœ“ 120å°æ™‚å¾…æ©Ÿ - è¶³30å°æ™‚æ’­æ”¾","âœ“ 360åº¦ç’°ç¹éŸ³ - partyå—¨çˆ†å¤©"], srp: "$368" },
    { id: 6, name: "M0 OLED QI2 è¶…è–„ç£å¸ç„¡ç·šå……é›»å¯¶", brand: "inno3C", brandDesc: "inno3C - å‰µæ–°3Cç§‘æŠ€å“ç‰Œï¼Œå°ˆæ³¨æ–¼æ™ºèƒ½ç”Ÿæ´»é›»å™¨", model: "i-3C5M2", emoji: "ğŸ”‹", pain: ["âœ“ æ¥µè–„è¼•é‡ - åªå¾—4mmåšåº¦","âœ“ ç£å¸å³å…… - ä¸€ç§’é–‹å§‹å……é›»","âœ“ å®‰å…¨å¯é  - æ™ºèƒ½èŠ¯ç‰‡è‡ªå‹•èª¿æ§","âœ“ å¿«å……æŠ€è¡“ - 15åˆ†é˜å¿«å……50%"], srp: "$368" }
];

let currentUser = null;
let selectedGadget = null;
let reports = JSON.parse(localStorage.getItem('sales_reports')) || [];

document.getElementById('user-role').addEventListener('change', function() {
    document.getElementById('admin-pass-section').style.display = this.value === 'admin' ? 'block' : 'none';
});

function initializeGadgets() {
    const grid = document.getElementById('gadgets-grid');
    grid.innerHTML = '';
    GADGETS.forEach(gadget => {
        const card = document.createElement('button');
        card.type = 'button';
        card.className = 'gadget-card';
        card.innerHTML = `<div class="gadget-img">${gadget.emoji}</div><div class="gadget-label"><strong>${gadget.brand}</strong><br>${gadget.model}</div>`;
        card.onclick = (e) => { e.preventDefault(); selectGadget(gadget); };
        grid.appendChild(card);
    });
}

function selectGadget(gadget) {
    selectedGadget = gadget;
    document.querySelectorAll('.gadget-card').forEach((c, i) => {
        c.classList.toggle('active', GADGETS[i].id === gadget.id);
    });
    document.getElementById('detail-emoji').textContent = gadget.emoji;
    document.getElementById('detail-name').textContent = gadget.name;
    document.getElementById('detail-brand').textContent = gadget.brand;
    document.getElementById('detail-brand-desc').textContent = gadget.brandDesc;
    document.getElementById('detail-model').textContent = gadget.model;
    document.getElementById('detail-srp').textContent = gadget.srp;
    document.getElementById('detail-pain').innerHTML = gadget.pain.map(p => `<li>${p}</li>`).join('');
    document.getElementById('gadget-detail').classList.add('active');
    document.querySelector('.qty-input').style.display = 'block';
    document.getElementById('qty-label').textContent = `${gadget.name} éŠ·å”®æ•¸é‡`;
}

function handleLogin() {
    const name = document.getElementById('user-name').value.trim();
    const role = document.getElementById('user-role').value;
    const pass = document.getElementById('admin-pass').value;
    
    if (!name) { alert('âŒ è«‹è¼¸å…¥åå­—'); return; }
    if (!role) { alert('âŒ è«‹é¸æ“‡èº«ä»½'); return; }
    if (role === 'admin' && pass !== ADMIN_PASSWORD) { alert('âŒ å¯†ç¢¼éŒ¯èª¤'); return; }
    
    currentUser = { name, role };
    document.getElementById('login-screen').style.display = 'none';
    
    if (role === 'staff') {
        document.getElementById('staff-screen').style.display = 'block';
        document.getElementById('admin-screen').style.display = 'none';
        document.getElementById('staff-name').textContent = `åŒäº‹: ${name}`;
        document.getElementById('staff-date').textContent = `æ—¥æœŸ: ${new Date().toLocaleDateString('zh-HK')}`;
        initializeGadgets();
    } else {
        document.getElementById('admin-screen').style.display = 'block';
        document.getElementById('staff-screen').style.display = 'none';
        refreshAdminView();
    }
}

function logout() {
    currentUser = null;
    selectedGadget = null;
    document.getElementById('login-screen').style.display = 'flex';
    document.getElementById('staff-screen').style.display = 'none';
    document.getElementById('admin-screen').style.display = 'none';
    document.getElementById('user-name').value = '';
    document.getElementById('user-role').value = '';
    document.getElementById('admin-pass').value = '';
    document.getElementById('admin-pass-section').style.display = 'none';
}

function submitStaffReport(e) {
    e.preventDefault();
    
    const cis = parseInt(document.getElementById('cis').value) || 0;
    const vas = parseInt(document.getElementById('vas').value) || 0;
    const leader = document.getElementById('leader').value;
    const adhoc1 = parseInt(document.getElementById('adhoc1').value) || 0;
    const adhoc2 = parseInt(document.getElementById('adhoc2').value) || 0;
    const adhoc3 = parseInt(document.getElementById('adhoc3').value) || 0;
    const qty = parseInt(document.getElementById('gadget-qty').value) || 0;
    const notes = document.getElementById('notes').value;
    
    if (!leader) { alert('âŒ è«‹é¸æ“‡ Leader'); return; }
    
    const gadgetName = selectedGadget && qty > 0 ? `${selectedGadget.brand} ${selectedGadget.model} (x${qty})` : 'ç„¡';
    
    const now = new Date();
    const report = {
        date: now.toISOString().split('T')[0],
        staff: currentUser.name,
        leader,
        cis, vas, adhoc1, adhoc2, adhoc3,
        gadget: gadgetName,
        notes
    };
    
    reports.push(report);
    localStorage.setItem('sales_reports', JSON.stringify(reports));
    
    // è‡ªå‹•åŒæ­¥åˆ° SharePoint
    syncToSharePoint(report);
    
    document.getElementById('success-msg').classList.add('show');
    setTimeout(() => document.getElementById('success-msg').classList.remove('show'), 3000);
    
    e.target.reset();
    document.querySelectorAll('.gadget-card').forEach(c => c.classList.remove('active'));
    document.getElementById('gadget-detail').classList.remove('active');
    document.querySelector('.qty-input').style.display = 'none';
    selectedGadget = null;
}

function refreshAdminView() {
    const today = new Date().toISOString().split('T')[0];
    const todayData = reports.filter(r => r.date === today);
    
    let cis = 0, vas = 0, adhoc = 0;
    todayData.forEach(r => { cis += r.cis; vas += r.vas; adhoc += r.adhoc1 + r.adhoc2 + r.adhoc3; });
    
    document.getElementById('stats-grid').innerHTML = `
        <div class="stat-box"><div class="stat-label">ä»Šæ—¥ CIS</div><div class="stat-value">${cis}</div></div>
        <div class="stat-box"><div class="stat-label">ä»Šæ—¥ VAS</div><div class="stat-value" style="color: #10b981;">${vas}</div></div>
        <div class="stat-box"><div class="stat-label">Ad-Hoc VAS</div><div class="stat-value" style="color: #ef4444;">${adhoc}</div></div>
        <div class="stat-box"><div class="stat-label">å ±æ•¸æ¬¡æ•¸</div><div class="stat-value" style="color: #8b5cf6;">${todayData.length}</div></div>
    `;
    
    const tbody = document.getElementById('table-body');
    tbody.innerHTML = '';
    
    if (reports.length === 0) {
        document.getElementById('no-data-msg').style.display = 'block';
        return;
    }
    
    document.getElementById('no-data-msg').style.display = 'none';
    reports.slice().reverse().forEach(r => {
        tbody.innerHTML += `<tr><td>${r.date}</td><td>${r.staff}</td><td>${r.leader || '-'}</td><td>${r.cis}</td><td>${r.vas}</td><td>${r.adhoc1}</td><td>${r.adhoc2}</td><td>${r.adhoc3}</td><td>${r.gadget}</td><td>${r.notes}</td></tr>`;
    });
}

// åŒæ­¥åˆ° SharePoint å‡½æ•¸
function syncToSharePoint(report) {
    // ä½¿ç”¨ Microsoft Graph API
    const accessToken = localStorage.getItem('sharepoint_token');
    if (!accessToken) {
        console.log('âš ï¸ SharePoint Token æœªè¨­å®šï¼Œè³‡æ–™å°‡ä¿å­˜åœ¨æœ¬åœ°');
        return;
    }
    
    const sharePointUrl = 'https://graph.microsoft.com/v1.0/me/drive/items/root:/Testing%201.xlsx:/content';
    
    // è®€å–ç¾æœ‰ Excelï¼ŒåŠ å…¥æ–°è¡Œï¼Œå†ä¸Šå‚³å›å»
    console.log('ğŸ“¤ æ­£åœ¨åŒæ­¥åˆ° SharePoint:', report);
}

// ä¸Šå‚³åˆ° SharePoint æŒ‰éˆ•
function exportToSharePoint() {
    if (reports.length === 0) { alert('âŒ æ²’æœ‰æ•¸æ“š'); return; }
    
    // ç”Ÿæˆ CSV
    let csv = 'æ—¥æœŸ,åŒäº‹åç¨±,Leader,CIS,VAS,2500M,Router,PCD NEW,ç¦®å“éŠ·å”®,å‚™è¨»\n';
    reports.forEach(r => {
        csv += `${r.date},${r.staff},${r.leader || '-'},${r.cis},${r.vas},${r.adhoc1},${r.adhoc2},${r.adhoc3},"${r.gadget}","${r.notes}"\n`;
    });
    
    // è¤‡è£½åˆ°å‰ªè²¼æ¿ä¾›ç”¨æˆ¶æ‰‹å‹•ä¸Šå‚³
    const blob = new Blob(['\uFEFF' + csv], { type: 'text/csv' });
    const link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.download = `Sales_Report_${new Date().toISOString().split('T')[0]}.csv`;
    link.click();
    
    alert('âœ… CSV å·²ç”Ÿæˆï¼æ‚¨å¯ä»¥æ‰‹å‹•ä¸Šå‚³åˆ° SharePoint:\nhttps://pccw0-my.sharepoint.com/personal/01415124_corphq_hk_pccw_com/Documents/Testing%201.xlsx');
}

initializeGadgets();
</script>

</body>
</html>
